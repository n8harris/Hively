/*! JsRender v1.0pre: http://github.com/BorisMoore/jsrender */
/*
* Optimized version of jQuery Templates, for rendering to string.
* Does not require jQuery, or HTML DOM
* Integrates with JsViews (http://github.com/BorisMoore/jsviews)
* Copyright 2013, Boris Moore
* Released under the MIT License.
*/
// informal pre beta commit counter: 37 (Beta Candidate)

(function(e,t,n){"use strict";function _(e,t){if(t&&t.onError){if(t.onError(e)===false){return}}this.name="JsRender Error";this.message=e||"JsRender error"}function D(e,t){var n;e=e||{};for(n in t){e[n]=t[n]}return e}function P(e,t,n){if(!it.rTag||arguments.length){a=e?e.charAt(0):a;f=e?e.charAt(1):f;l=t?t.charAt(0):l;c=t?t.charAt(1):c;h=n||h;e="\\"+a+"(\\"+h+")?\\"+f;t="\\"+l+"\\"+c;o="(?:(?:(\\w+(?=[\\/\\s\\"+l+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))"+"\\s*((?:[^\\"+l+"]|\\"+l+"(?!\\"+c+"))*?)";it.rTag=o+")";o=new RegExp(e+o+"(\\/)?|(?:\\/(\\w+)))"+t,"g");u=new RegExp("<.*>|([^\\\\]|^)[{}]|"+e+".*"+t)}return[a,f,l,c,h]}function H(e,t){if(!t){t=e;e=n}var r,i,s,o,u=this,a=!t||t==="root";if(e){o=u.type===t?u:n;if(!o){r=u.views;if(u._.useKey){for(i in r){if(o=r[i].get(e,t)){break}}}else for(i=0,s=r.length;!o&&i<s;i++){o=r[i].get(e,t)}}}else if(a){while(u.parent.parent){o=u=u.parent}}else while(u&&!o){o=u.type===t?u:n;u=u.parent}return o}function B(){var e=this.get("item");return e?e.index:n}function j(e){var t,r=this,i=(r.ctx||{})[e];i=i===n?r.getRsc("helpers",e):i;if(i){if(typeof i==="function"){t=function(){return i.apply(r,arguments)};D(t,i)}}return t||i}function F(e,t,r){var i,s,o,u=+r===r&&r,a=t.linkCtx;if(u){r=(u=t.tmpl.bnds[u-1])(t.data,t,M)}o=r.args[0];if(e||u){s=a&&a.tag||{_:{inline:!a},tagName:e+":",flow:true,_is:"tag"};s._.bnd=u;if(a){a.tag=s;s.linkCtx=a;r.ctx=Z(r.ctx,a.view.ctx)}s.tagCtx=r;r.view=t;s.ctx=r.ctx||{};delete r.ctx;t._.tag=s;e=e!=="true"&&e;if(e&&((i=t.getRsc("converters",e))||J("Unknown converter: {{"+e+":"))){s.depends=i.depends;o=i.apply(s,r.args)}o=u&&t._.onRender?t._.onRender(o,t,u):o;t._.tag=n}return o}function I(e,t){var r,i=this,s=M[e];r=s&&s[t];while(r===n&&i){s=i.tmpl[e];r=s&&s[t];i=i.parent}return r}function q(e,t,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w="",E=+i===i&&i,S=t.linkCtx||0,x=t.ctx,T=r||t.tmpl,N=t._;if(e._is==="tag"){o=e;e=o.tagName}if(E){i=(g=T.bnds[E-1])(t.data,t,M)}h=i.length;o=o||S.tag;for(c=0;c<h;c++){d=i[c];m=d.tmpl;m=d.content=m&&T.tmpls[m-1];r=d.props.tmpl;if(!c&&(!r||!o)){y=t.getRsc("tags",e)||J("Unknown tag: {{"+e+"}}")}r=r||(o?o._def:y).template||m;r=""+r===r?t.getRsc("templates",r)||et(r):r;D(d,{tmpl:r,render:$,index:c,view:t,ctx:Z(d.ctx,x)});if(!o){if(y._ctr){o=new y._ctr;b=!!o.init;o.attr=o.attr||y.attr||n}else{o={render:y.render}}o._={inline:!S};if(S){S.attr=o.attr=S.attr||o.attr;S.tag=o;o.linkCtx=S}if(o._.bnd=g||S){o._.arrVws={}}o.tagName=e;o.parent=l=x&&x.tag,o._is="tag";o._def=y}N.tag=o;d.tag=o;o.tagCtxs=i;if(!o.flow){v=d.ctx=d.ctx||{};u=o.parents=v.parentTags=x&&Z(v.parentTags,x.parentTags)||{};if(l){u[l.tagName]=l}v.tag=o}o.rendering={}}for(c=0;c<h;c++){d=o.tagCtx=i[c];o.ctx=d.ctx;if(!c&&b){o.init(d,S,o.ctx);b=n}if(s=o.render){p=s.apply(o,d.args)}w+=p!==n?p:d.tmpl?d.render():""}delete o.rendering;o.tagCtx=o.tagCtxs[0];o.ctx=o.tagCtx.ctx;if(o._.inline&&(a=o.attr)&&a!=="html"){w=a==="text"?tt.html(w):""}return w=E&&t._.onRender?t._.onRender(w,t,E):w}function R(e,t,r,i,s,o,u,a){var f,l,c,h=t==="array",p={key:0,useKey:h?0:1,id:""+N++,onRender:a,bnds:{}},d={data:i,tmpl:s,content:u,views:h?[]:{},parent:r,ctx:e,type:t,get:H,getIndex:B,getRsc:I,hlp:j,_:p,_is:"view"};if(r){f=r.views;l=r._;if(l.useKey){f[p.key="_"+l.useKey++]=d;c=l.tag;p.bnd=h&&(!c||!!c._.bnd&&c)}else{f.splice(p.key=d.index=o!==n?o:f.length,0,d)}d.ctx=e||r.ctx}return d}function U(e){var t,n,r,i,s;for(t in O){i=O[t];if((s=i.compile)&&(n=e[t+"s"])){for(r in n){n[r]=s(r,n[r],e,t,i)}}}}function z(e,t,n){var r,i;if(typeof t==="function"){t={depends:t.depends,render:t}}else{if(i=t.template){t.template=""+i===i?et[i]||et(i):i}if(t.init!==false){r=t._ctr=function(e){};(r.prototype=t).constructor=r}}if(n){t._parentTmpl=n}return t}function W(r,i,s,o,a,f){function l(n){if(""+n===n||n.nodeType>0){try{h=n.nodeType>0?n:!u.test(n)&&t&&t(e.document).find(n)[0]}catch(i){}if(h){n=h.getAttribute(k);r=r||n;n=et[n];if(!n){r=r||"_"+T++;h.setAttribute(k,r);n=et[r]=W(r,h.innerHTML,s,o,a,f)}}return n}}var c,h;i=i||"";c=l(i);f=f||(i.markup?i:{});f.tmplName=r;if(s){f._parentTmpl=s}if(!c&&i.markup&&(c=l(i.markup))){if(c.fn&&(c.debug!==i.debug||c.allowCode!==i.allowCode)){c=c.markup}}if(c!==n){if(r&&!s){A[r]=function(){return i.render.apply(i,arguments)}}if(c.fn||i.fn){if(c.fn){if(r&&r!==c.tmplName){i=Z(f,c)}else{i=c}}}else{i=X(c,f);Q(c,i)}U(f);return i}}function X(e,t){var n,r=st.wrapMap||{},s=D({markup:e,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:$},t);if(!t.htmlTag){n=w.exec(e);s.htmlTag=n?n[1].toLowerCase():""}n=r[s.htmlTag];if(n&&n!==r.div){s.markup=i.trim(s.markup);s._elCnt=true}return s}function V(e,t){function r(s,o,u){var a,f,l,c;if(s&&""+s!==s&&!s.nodeType&&!s.markup){for(l in s){r(l,s[l],o)}return M}if(o===n){o=s;s=n}if(s&&""+s!==s){u=o;o=s;s=n}c=u?u[i]=u[i]||{}:r;f=t.compile;if(a=it.onBeforeStoreItem){f=a(c,s,o,f)||f}if(!s){o=f(n,o)}else if(o===null){delete c[s]}else{c[s]=f?o=f(s,o,u,e,t):o}if(o){o._is=e}if(a=it.onStoreItem){a(c,s,o,f)}return o}var i=e+"s";M[i]=r;O[e]=t}function $(e,t,r,s,o,u){var a,f,l,c,h,p,d,v,m,g,y,b,w,E=this,S=!E.attr||E.attr==="html",x="";if(s===true){d=true;s=0}if(E.tag){v=E;E=E.tag;g=E._;b=E.tagName;w=v.tmpl;t=Z(t,E.ctx);m=v.content;if(v.props.link===false){t=t||{};t.link=false}r=r||v.view;e=e===n?r:e}else{w=E.jquery&&(E[0]||J('Unknown template: "'+E.selector+'"'))||E}if(w){if(!r&&e&&e._is==="view"){r=e}if(r){m=m||r.content;u=u||r._.onRender;if(e===r){e=r.data;o=true}t=Z(t,r.ctx)}if(!r||r.data===n){(t=t||{}).root=e}if(!w.fn){w=et[w]||et(w)}if(w){u=(t&&t.link)!==false&&S&&u;y=u;if(u===true){y=n;u=r._.onRender}if(i.isArray(e)&&!o){c=d?r:s!==n&&r||R(t,"array",r,e,w,s,m,u);for(a=0,f=e.length;a<f;a++){l=e[a];h=R(t,"item",c,l,w,(s||0)+a,m,u);p=w.fn(l,h,M);x+=c._.onRender?c._.onRender(p,h):p}}else{c=d?r:R(t,b||"data",r,e,w,s,m,u);if(g&&!E.flow){c.tag=E}x+=w.fn(e,c,M)}return y?y(x,c):x}}return""}function J(e){throw new M.sub.Error(e)}function K(e){J("Syntax error\n"+e)}function Q(e,t,n,r){function i(t){t-=c;if(t){p.push(e.substr(c,t).replace(v,"\\n"))}}function s(t){t&&K('Unmatched or missing tag: "{{/'+t+'}}" in template:\n'+e)}function u(o,u,l,g,w,E,S,x,T,N,C,k){if(E){w=":";g="html"}N=N||n;var L,A,O=u&&[],M="",_="",D="",P=!N&&!w&&!S;l=l||w;i(k);c=k+o.length;if(x){if(f){p.push(["*","\n"+T.replace(m,"$1")+"\n"])}}else if(l){if(l==="else"){if(b.test(T)){K('for "{{else if expr}}" use "{{else expr}}"')}O=d[6];d[7]=e.substring(d[7],k);d=h.pop();p=d[3];P=true}if(T){T=T.replace(v," ");M=Y(T,O,t).replace(y,function(e,t,n){if(t){D+=n+","}else{_+=n+","}return""})}_=_.slice(0,-1);M=M.slice(0,-1);L=_&&_.indexOf("noerror:true")+1&&_||"";a=[l,g||!!r||"",M,P&&[],'params:"'+T+'",props:{'+_+"}"+(D?",ctx:{"+D.slice(0,-1)+"}":""),L,O||0];p.push(a);if(P){h.push(d);d=a;d[7]=c}}else if(C){A=d[0];s(C!==A&&A!=="else"&&C);d[7]=e.substring(d[7],k);d=h.pop()}s(!d&&C);p=d[3]}var a,f=t&&t.allowCode,l=[],c=0,h=[],p=l,d=[,,,l];e=e.replace(g,"\\$1");s(h[0]&&h[0][3].pop()[0]);e.replace(o,u);i(e.length);if(c=l[l.length-1]){s(""+c!==c&&+c[7]===c[7]&&c[0])}return G(l,n?e:t,n)}function G(e,n,r){var i,s,o,u,a,f,l,c,h,p,d,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P=0,H="",B="",j={},F=e.length;if(""+n===n){E=r?'data-link="'+n.replace(v," ").slice(1,-1)+'"':n;n=0}else{E=n.tmplName||"unnamed";if(T=n.allowCode){j.allowCode=true}if(n.debug){j.debug=true}m=n.bnds;w=n.tmpls}for(i=0;i<F;i++){s=e[i];if(""+s===s){H+='\nret+="'+s+'";'}else{o=s[0];if(o==="*"){H+=""+s[1]}else{u=s[1];a=s[2];N=s[3];f=s[4];B=s[5];C=s[7];if(!(O=o==="else")){P=0;if(m&&(g=s[6])){P=m.push(g)}}if(M=o===":"){if(u){o=u==="html"?">":u+o}if(B){_="prm"+i;B="try{var "+_+"=["+a+"][0];}catch(e){"+_+'="";}\n';a=_}}else{if(N){S=X(C,j);S.tmplName=E+"/"+o;G(N,S);w.push(S)}if(!O){x=o;A=H;H="";y=i}L=e[i+1];L=L&&L[0]==="else"}f+=",args:["+a+"]}";if(M&&g||u&&o!==">"){D=new Function("data,view,j,u"," // "+E+" "+P+" "+o+"\n"+B+"return {"+f+";");D.paths=g;D._ctxs=o;if(r){return D}d=1}H+=M?"\n"+(g?"":B)+(r?"return ":"ret+=")+(d?(d=0,p=true,'c("'+u+'",view,'+(g?(m[P-1]=D,P):"{"+f)+");"):o===">"?(c=true,"h("+a+");"):(h=true,"(v="+a+")!="+(r?"=":"")+'u?v:"";')):(l=true,"{tmpl:"+(N?w.length:"0")+","+f+",");if(x&&!L){H="["+H.slice(0,-1)+"]";if(r||g){H=new Function("data,view,j,u"," // "+E+" "+P+" "+x+"\nreturn "+H+";");if(g){(m[P-1]=H).paths=g}H._ctxs=o;if(r){return H}}H=A+'\nret+=t("'+x+'",view,this,'+(P||H)+");";g=0;x=0}}}}H="// "+E+"\nvar j=j||"+(t?"jQuery.":"js")+"views"+(h?",v":"")+(l?",t=j._tag":"")+(p?",c=j._cnvt":"")+(c?",h=j.converters.html":"")+(r?";\n":',ret="";\n')+(st.tryCatch?"try{\n":"")+(j.debug?"debugger;":"")+H+(r?"\n":"\nreturn ret;\n")+(st.tryCatch?"\n}catch(e){return j._err(e);}":"");try{H=new Function("data,view,j,u",H)}catch(I){K("Compiled template code:\n\n"+H,I)}if(n){n.fn=H}return H}function Y(e,t,n){function r(r,d,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P){function B(e,n,r,i,o,u,a){if(n){t&&!s&&t.push(b);if(n!=="."){var f=(r?'view.hlp("'+r+'")':i?"view":"data")+(a?(o?"."+o:r?"":i?"":"."+n)+(u||""):(a=r?"":i?o||"":n,""));f=f+(a?"."+a:"");return f.slice(0,9)==="view.data"?f.slice(5):f}}return e}var H;w=w||"";y=y||d||C;b=b||x;T=T||M||"";if(E){K(e)}else{if(t&&O){H=h[v];if(P.length-2>D-H){H=P.slice(H,D+1);O=f+":"+H+l;O=o[O]=o[O]||Q(a+O+c,n,true);if(!O.paths){Y(H,O.paths=[],n)}t.push({_jsvOb:O})}}return g?(g=!k,g?r:'"'):m?(m=!L,m?r:'"'):(y?(v++,h[v]=D++,y):"")+(_?v?"":i?(i=s=false,"\b"):",":S?(v&&K(e),i=b,s=b.charAt(0)==="~","\b"+b+":"):b?b.split("^").join(".").replace(p,B)+(T?(u[++v]=true,b.charAt(0)!=="."&&(h[v]=D),T):w):w?w:A?(u[v--]=false,A)+(T?(u[++v]=true,T):""):N?(u[v]||K(e),","):d?"":(g=k,m=L,'"'))}}var i,s,o=n.links,u={},h={0:-1},v=0,m=false,g=false;return(e+" ").replace(d,r)}function Z(e,t){return e&&e!==t?t?D(D({},t),e):e:t&&D({},t)}function ot(e){return C[e]||(C[e]="&#"+e.charCodeAt(0)+";")}if(t&&t.views||e.jsviews){return}var r="v1.0pre",i,s,o,u,a="{",f="{",l="}",c="}",h="^",p=/^(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,d=/(\()(?=\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^)|[)\]])([([]?))|(\s+)/g,v=/\s*\n/g,m=/\\(['"])/g,g=/\\?(['"\\])/g,y=/\x08(~)?([^\x08]+)\x08/g,b=/^if\s/,w=/<(\w+)[>\s]/,E=/<(\w+)[^>\/]*>[^>]*$/,S=/[\x00`><"'&]/g,x=S,T=0,N=0,C={"&":"&","<":"<",">":">","\0":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},k="data-jsv-tmpl",L=[].slice,A={},O={template:{compile:W},tag:{compile:z},helper:{},converter:{}},M={jsviews:r,render:A,settings:{delimiters:P,debugMode:true,tryCatch:true},sub:{View:R,Error:_,tmplFn:Q,parse:Y,extend:D,error:J,syntaxError:K},_cnvt:F,_tag:q,_err:function(e){return st.debugMode?"Error: "+(e.message||e)+". ":""}};(_.prototype=new Error).constructor=_;B.depends=function(){return[this.get("item"),"index"]};for(s in O){V(s,O[s])}var et=M.templates,tt=M.converters,nt=M.helpers,rt=M.tags,it=M.sub,st=M.settings;if(t){i=t;i.fn.render=$}else{i=e.jsviews={};i.isArray=Array&&Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}}i.render=A;i.views=M;i.templates=et=M.templates;rt({"else":function(){},"if":{render:function(e){var t=this,n=t.rendering.done||!e&&(arguments.length||!t.tagCtx.index)?"":(t.rendering.done=true,t.selected=t.tagCtx.index,t.tagCtx.render());return n},onUpdate:function(e,t,n){var r,i,s;for(r=0;(i=this.tagCtxs[r])&&i.args.length;r++){i=i.args[0];s=!i!==!n[r].args[0];if(!!i||s){return s}}return false},flow:true},"for":{render:function(e){var t,r,s=this,o=s.tagCtx,u=!arguments.length,a="",f=u||0;if(!s.rendering.done){if(u){a=n}else if(e!==n){a+=o.render(e);f+=i.isArray(e)?e.length:1}if(s.rendering.done=f){s.selected=o.index}}return a},onUpdate:function(e,t,n){},onArrayChange:function(e,t){var n,r=this,i=t.change;if(this.tagCtxs[1]&&(i==="insert"&&e.target.length===t.items.length||i==="remove"&&!e.target.length||i==="refresh"&&!t.oldItems.length!==!e.target.length)){this.refresh()}else{for(n in r._.arrVws){n=r._.arrVws[n];if(n.data===e.target){n._.onArrayChange.apply(n,arguments)}}}e.done=true},flow:true},include:{flow:true},"*":{render:function(e){return e},flow:true}});tt({html:function(e){return e!=n?String(e).replace(x,ot):""},attr:function(e){return e!=n?String(e).replace(S,ot):e===null?null:""},url:function(e){return e!=n?encodeURI(String(e)):e===null?null:""}});P()})(this,this.jQuery)

