var alloy={};alloy.global=this,alloy.tmpl=alloy.tmpl||{},alloy.views=alloy.views||{},alloy.events=alloy.events||{},alloy.nullFunction=function(){},alloy.abstractFunction=function(){throw new Error("Abstract function missing implementation.")},alloy.makeSingleton=function(e){e.setInstance=function(){return e.__instance=new e(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},e.getInstance=function(){return e.__instance||e.setInstance.apply(this,arguments)},e.deleteInstance=function(){e.__instance=null}},alloy.inheritFrom=function(e,t){function n(){}n.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new n,t.prototype.constructor=t},alloy.isDefined=function(e){return void 0!==e},alloy.isNull=function(e){return null===e},alloy.isDefindedAndNotNull=function(e){return null!=e},alloy.buildIndexByField=function(e,t){for(var n={},i=0;i<e.length;i++)n[e[i][t]]=e[i];return n},alloy.buildIndexFromValue=function(e){for(var t={},n=0;n<e.length;n++)t[e[n]]=e[n];return t},alloy.Session=function(e){this._sessionId=null,this._loggedIn=!1,this._email=null,this._lastLoginDate=null,this._role="anon",this._isAdmin=!1,e&&this.swallowApiCall(e)},alloy.makeSingleton(alloy.Session),alloy.Session.EVENT_SESSION_CHANGE="alloy_event_session_change",alloy.Session.EVENT_LOGIN_FAILURE="alloy_event_login_failure",alloy.Session.EVENT_LOGOUT_FAILURE="alloy_event_logout_failure",alloy.Session.prototype.swallowApiCall=function(e){if(e.session_id&&e.role)switch(this._sessionId=e.session_id,this._email=e.email,this._role=e.role,this._lastLoginDate=this._lastLoginDate?this._lastLoginDate:e.last_login_date,this._loggedIn=!1,this._isAdmin=!1,this._role){case"admin":this._isAdmin=!0,this._loggedIn=!0;break;case"user":this._loggedIn=!0}},alloy.Session.prototype.login=function(e,t){var n=function(e){this._loggedIn=!0,$(window.document).trigger(alloy.Session.EVENT_SESSION_CHANGE,!0)},i=function(e){$(window.document).trigger(alloy.Session.EVENT_LOGIN_FAILURE)};alloy.Api.getInstance().request({api:"user",call:"login",data:{email:e,password:t},success:$.proxy(n,this),error:$.proxy(i,this)})},alloy.Session.prototype.logout=function(){var e=function(e){this._loggedIn=!1,this._role="anon",$(window.document).trigger(alloy.Session.EVENT_SESSION_CHANGE,!1)},t=function(e){$(window.document).trigger(alloy.Session.EVENT_LOGOUT_FAILURE)};alloy.Api.getInstance().request({api:"user",call:"logout",data:{},success:$.proxy(e,this),error:$.proxy(t,this)})},alloy.Session.prototype.setSessionId=function(e){this._sessionId=e},alloy.Session.prototype.getSessionId=function(){return this._sessionId},alloy.Session.prototype.isLoggedIn=function(){return this._loggedIn},alloy.Session.prototype.getSessionId=function(){return this._sessionId},alloy.Session.prototype.isAdmin=function(){return this._isAdmin},alloy.Session.prototype.getEmail=function(){return this._email},alloy.Api=function(){this._requests=[]},alloy.makeSingleton(alloy.Api),alloy.Api.prototype.request=function(e){this._requests.push(e),1===this._requests.length&&this._makeNextCall()},alloy.Api.prototype._makeNextCall=function(e){if(0!==this._requests.length){var t=this._requests[0],n=t.data||{};n.api=t.api,n.call=t.call;var i=alloy.Session.getInstance().getSessionId(),s=function(e){return alloy.Session.getInstance().swallowApiCall(e),-1==e.status&&"Not authorized"==e.message?void $(window).trigger(alloy.events.SESSION_TIMEOUT):-1==e.status?void t.error(e):(e.status&&t.success&&t.success(e),!e.status&&t.error&&t.error(e),this._requests.shift(),void(this._requests.length>0&&this._makeNextCall()))},o=function(e){if(200!=e.status){{var t=this._requests[0].api;this._requests[0].call}if("logger"!=t){var n=" for request api:"+this._requests[0].api+" call: "+this._requests[0].call;this._requests.splice(0,1),alloy.Api.getInstance().request({api:"logger",call:"add",data:{message:'"'+e.status+" "+e.statusText+'"'+n},success:function(e){console.log(e)},error:function(e){console.log(e)}}),0!=e.status&&bootbox.alert("An error occurred while making a request: "+e.status+" - "+e.statusText)}this._requests.shift(),this._requests.length>0&&this._makeNextCall()}};$.ajax("/api",{data:n,success:$.proxy(s,this),error:$.proxy(o,this),type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization",i)}})}},alloy.View=Backbone.View.extend({initialize:function(e){_.bindAll(this),this._initialize(e),this._isRendered=!1,this._isBound=!1,this._inDom=!1},_initialize:function(e){},inject:function(e,t){return t=t?t:{},t=_.defaults(t,{method:"html"}),this._isRendered||this.render(),this._isBound||this.bind(),$(e)[t.method](this.el),this._inDom||this.onEnterDom(),this},injectChild:function(e,t,n){return e.inject(t,n),this.addChild(e),this},render:function(){return this._isRendered&&this.unbind(),this._render(),this.bind(),this._isRendered=!0,$("input, textarea",this.el).placeholder(),this},_render:function(){},addChild:function(e){return void 0==this._children&&(this._children=[]),this._children.push(e),this},clearChildren:function(){return this.unbindChildren(),this._children=[],this},bind:function(){return this._isBound?this:(this._isRendered&&this.delegateEvents(),this.bindChildren(),this._bind(),this._isBound=!0,this)},_bind:function(){},unbind:function(){return this.stopListening(),this.undelegateEvents(),this.unbindChildren(),this._unbind(),this._isBound=!1,this},_unbind:function(){},bindChildren:function(){if(this._children)for(var e=0;e<this._children.length;e++)this._children[e].bind();return this},unbindChildren:function(){if(this._children)for(var e=0;e<this._children.length;e++)this._children[e].unbind();return this},onEnterDom:function(){if(this._inDom=!0,this._onEnterDom(),this._children)for(var e=0;e<this._children.length;e++)this._children[e].onEnterDom();return this},_onEnterDom:function(){},onExitDom:function(){if(this._inDom=!1,this._onExitDom(),this._children)for(var e=0;e<this._children.length;e++)this._children[e].onExitDom();return this},_onExitDom:function(){}}),alloy.Alerts=function(){this._alerts=[]},alloy.makeSingleton(alloy.Alerts),alloy.Alerts.prototype.add=function(e){return this._alerts.push(e),this},alloy.Alerts.prototype.show=function(e){for(var t=0;t<this._alerts.length;t++)this._alerts[t].render(),$(e).append(this._alerts[t].el),$(e).is(":hidden")&&$(e).slideDown();return this._alerts=[],this},alloy.events.OVERLAY_CLOSED="overlay_closed",alloy.events.SESSION_TIMEOUT="session_timeout",alloy.OverlayManager=alloy.OverlayManager||{},alloy.OverlayManager=function(e){this._overlays=[],$(window.document).bind(alloy.OverlayManager.EVENT_CLOSE,$.proxy(this._onOverlayClose,this))},alloy.makeSingleton(alloy.OverlayManager),alloy.OverlayManager.EVENT_CLOSE="alloy_event_overlay_close",alloy.OverlayManager.prototype.add=function(e){this._overlays.push(e),1===this._overlays.length&&this.show(this._overlays[0])},alloy.OverlayManager.prototype.show=function(e){e.modalSize?e.modalSize:"large";e.render(),$(e.el).addClass("modal modal-"+e.modalSize),$(e.el).appendTo($("body")).modal({show:!0,backdrop:!0,keyboard:!1}),e.onEnterDom(),$("body").addClass("modal-open")},alloy.OverlayManager.prototype._onOverlayClose=function(e,t){this._overlays[0].unbind(),$(this._overlays[0].el).modal("hide"),this._overlays.shift(),this._overlays.length>0&&this.show(this._overlays[0])},alloy.OverlayManager.prototype.isOpen=function(){return this._overlays.length>0},alloy.OverlayManager.prototype.closeCurrent=function(){this._overlays.length>0&&($("body").removeClass("modal-open"),this._overlays[0].unbind(),$(this._overlays[0].el).modal("hide"),this._overlays.shift(),this._overlays.length>0&&this.show(this._overlays[0]),$(window.document).trigger(alloy.events.OVERLAY_CLOSED))},alloy.tmpl.alert=["<a class='close' data-dismiss='alert' href='#'>&times;</a>","{{if title}}<h5>${title}</h5>{{/if}}","{{if message}}<span>${message}</span>{{/if}}","{{if html}}<div id='html'></div>{{/if}}"].join(""),$.templates({"alloy.tmpl.alert":alloy.tmpl.alert}),App={environment:null,models:{},collections:{},tmpl:{},events:{USER_DELETED:"user_deleted",CONTENT_PROGRESS:"content_progress"},views:{},controls:{},overlays:{},vent:_.extend({},Backbone.Events)},App.Model=Backbone.Model.extend({}),App.Collection=Backbone.Collection.extend({model:App.Model}),App.Data=function(e){if(_.bindAll(this),e=e||{},e=_.defaults(e,{session:new App.Model,user:new App.Model,account:new App.Model,users:new App.Collection,clubhouseSubscription:new App.Model,completedTasks:new App.Collection,progress:new App.Collection,chapterActivities:new App.Collection}),_.extend(this,e),this.user.get("id")){var t=this.users.get(this.user.get("id"));t&&(this.user=t)}},alloy.makeSingleton(App.Data),App.Data.prototype.isLoggedIn=function(){return!("anon"==this.user.get("role")||void 0==this.user.get("role"))};
//# sourceMappingURL=../../maps/publicapp.min.js.map