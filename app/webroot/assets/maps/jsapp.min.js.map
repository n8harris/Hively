{"version":3,"sources":["app/webroot/js/alloy/alloy.js","app/webroot/js/alloy/alloy.session.js","app/webroot/js/alloy/alloy.api.js","app/webroot/js/alloy/alloy.view.js","app/webroot/js/alloy/alloy.alerts.js","app/webroot/js/alloy/alloy.events.js","app/webroot/js/alloy/alloy.overlay_manager.js","app/webroot/js/alloy/tmpl/alloy.tmpl.alert.js","app/webroot/js/app/app.js","app/webroot/js/app/router_base.js","app/webroot/js/app/router.js","app/webroot/assets/js/jsapp_templates_map.js","app/webroot/js/app/data.js","app/webroot/js/app/views/pages/view_page_businesses.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpDA;AACA;AACA;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChBA;AACA;AACA;AACA;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"jsapp.min.js","sourcesContent":["/**\n *  alloy.js - Part of the Alloy Library\n *\n *  Copyright (c) 2012, Tyler Seymour <tyler@unwitty.com>\n *  All rights reserved.\n *\n *  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the\n *  following conditions are met:\n *\n *  Redistributions of source code must retain the above copyright notice, this list of conditions and the following\n *  disclaimer.\n *\n *  Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following\n *  disclaimer in the documentation and/or other materials provided with the distribution.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n *  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n *  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n *  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n *  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n *  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n */\n\nvar alloy = {};\n\nalloy.global = this;\n\nalloy.tmpl = alloy.tmpl || {};\nalloy.views = alloy.views || {};\nalloy.events = alloy.events || {};\n\n\nalloy.nullFunction = function() {};\n\nalloy.abstractFunction = function() {\n\tthrow new Error(\"Abstract function missing implementation.\");\n};\n\nalloy.makeSingleton = function(ClassName) {\n\tClassName.setInstance = function() {\n\t\treturn ClassName.__instance = new ClassName(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);\n\t};\n\tClassName.getInstance = function() {\n\t\treturn ClassName.__instance || ClassName.setInstance.apply(this, arguments);\n\t};\n\tClassName.deleteInstance = function() {\n\t\tClassName.__instance = null;\n\t};\n};\n\nalloy.inheritFrom = function(parent, child) {\n\tfunction Constructor() {}\n\n\tConstructor.prototype = parent.prototype;\n\tchild.superClass_ = parent.prototype;\n\tchild.prototype = new Constructor();\n\tchild.prototype.constructor = child;\n};\n\nalloy.isDefined = function(value) {\n\treturn value !== undefined;\n};\n\nalloy.isNull = function(value) {\n\treturn value === null;\n};\n\nalloy.isDefindedAndNotNull = function(value) {\n\treturn value != null;\n};\n\n/**\n * Takes an array and builds a dictionary, with each key taken from the specified field in the record\n * @param {!array} ary\n * @param {!string} field\n * @return {object}\n */\n\nalloy.buildIndexByField = function(ary, field) {\n\n\tvar data = {};\n\tfor(var i = 0; i < ary.length; i++) {\n\t\tdata[ary[i][field]] = ary[i];\n\t}\n\treturn data;\n};\n\n/**\n * Take a simple array of values and creates a dictionary, where each value is also the key\n * @param {!array} ary\n */\nalloy.buildIndexFromValue = function(ary) {\n\n\tvar data = {};\n\tfor(var i = 0; i < ary.length; i++) {\n\t\tdata[ary[i]] = ary[i];\n\t}\n\treturn data;\n};","/**\n *  alloy.api.js - Part of the Alloy Library\n *\n *  Copyright (c) 2012, Tyler Seymour <tyler@unwitty.com>\n *  All rights reserved.\n *\n *  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the\n *  following conditions are met:\n *\n *  Redistributions of source code must retain the above copyright notice, this list of conditions and the following\n *  disclaimer.\n *\n *  Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following\n *  disclaimer in the documentation and/or other materials provided with the distribution.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n *  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n *  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n *  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n *  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n *  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n *  @require alloy.js\n *  @require alloy.api.js\n */\n\n/*global $ alloy */\n\n\nalloy.Session = function (data) {\n\n\t/**\n\t * The user's session id\n\t * @property\t{string}\n\t * @protected\n\t */\n\tthis._sessionId = null;\n\n\t/**\n\t * Whether or not user is logged in\n\t * @property\t{bool}\n\t * @protected\n\t */\n\tthis._loggedIn\t= false;\n\n\t/**\n\t * User's email address\n\t * @property\t{string}\n\t * @protected\n\t */\n\tthis._email\t\t= null;\n\n\t/**\n\t * User's last login date\n\t * @property\t{string}\n\t * @protected\n\t */\n\tthis._lastLoginDate\t\t= null;\n\n\t/**\n\t * User's role\n\t * @property\tstring\n\t * @protected\n\t */\n\tthis._role\t= \"anon\";\n\n\t/**\n\t * Whether or not the user has administrative rights\n\t * @property\t{bool}\n\t * @protected\n\t * TODO: Decouple from public library\n\t */\n\tthis._isAdmin\t= false;\n\n\tif(data) {\n\t\tthis.swallowApiCall(data);\n\t}\n};\nalloy.makeSingleton(alloy.Session);\n\n/**\n * Triggered on successful login/logout.\n */\nalloy.Session.EVENT_SESSION_CHANGE\t= 'alloy_event_session_change';\n\n/**\n * Triggered on login failure\n */\nalloy.Session.EVENT_LOGIN_FAILURE\t= 'alloy_event_login_failure';\n\n/**\n * Triggered on logout failure\n */\nalloy.Session.EVENT_LOGOUT_FAILURE\t= 'alloy_event_logout_failure';\n\n/**\n * Processes a response from the backend API, updates session information\n * @param {!object} response\n */\nalloy.Session.prototype.swallowApiCall = function (response) {\n\n\tif (response.session_id && response.role) {\n\n\t\tthis._sessionId = response.session_id;\n\t\tthis._email\t\t= response.email;\n\t\tthis._role\t\t= response.role;\n\t\tthis._lastLoginDate = this._lastLoginDate ? this._lastLoginDate : response.last_login_date;\n\t\tthis._loggedIn\t= false;\n\t\tthis._isAdmin\t= false;\n\n\t\tswitch(this._role) {\n\t\t\tcase 'admin':\n\t\t\t\tthis._isAdmin = true;\n\t\t\t\tthis._loggedIn = true;\n\t\t\t\tbreak;\n\t\t\tcase 'user':\n\t\t\t\tthis._loggedIn = true;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n};\n\n/**\n * Attempt to log log the user in.\n *\n * @param {!string} email\n * @param {!string} password\n */\nalloy.Session.prototype.login = function (email, password) {\n\n\tvar success = function (response) {\n\t\tthis._loggedIn = true;\n\t\t$(window.document).trigger(alloy.Session.EVENT_SESSION_CHANGE, true);\n\t};\n\tvar error = function (response) {\n\t\t$(window.document).trigger(alloy.Session.EVENT_LOGIN_FAILURE);\n\t};\n\n\talloy.Api.getInstance().request({\n\t\tapi\t\t\t: \"user\",\n\t\tcall\t\t: \"login\",\n\t\tdata\t\t: {\n\t\t\temail\t\t: email,\n\t\t\tpassword\t: password\n\t\t},\n\t\tsuccess\t\t: $.proxy(success,\tthis),\n\t\terror\t\t: $.proxy(error,\tthis)\n\t});\n};\n\n/**\n * Attempt to log the user out\n */\nalloy.Session.prototype.logout = function () {\n\n\tvar success = function (event) {\n\t\tthis._loggedIn\t= false;\n\t\tthis._role\t\t= 'anon';\n\t\t$(window.document).trigger(alloy.Session.EVENT_SESSION_CHANGE, false);\n\t};\n\tvar error = function (event) {\n\t\t$(window.document).trigger(alloy.Session.EVENT_LOGOUT_FAILURE);\n\t};\n\n\talloy.Api.getInstance().request({\n\t\tapi\t\t: 'user',\n\t\tcall\t: 'logout',\n\t\tdata\t: {},\n\t\tsuccess : $.proxy(success, this),\n\t\terror\t: $.proxy(error, this)\n\t});\n};\n\nalloy.Session.prototype.setSessionId = function (sessionId) {\n\tthis._sessionId = sessionId;\n};\n\nalloy.Session.prototype.getSessionId = function () {\n\treturn this._sessionId;\n};\n\nalloy.Session.prototype.isLoggedIn = function () {\n\treturn this._loggedIn;\n};\n\nalloy.Session.prototype.getSessionId = function () {\n\treturn this._sessionId;\n};\n\nalloy.Session.prototype.isAdmin = function () {\n\treturn this._isAdmin;\n};\n\nalloy.Session.prototype.getEmail = function () {\n\treturn this._email;\n};\n","/**\n *  alloy.api.js - Part of the Alloy Library\n *\n *  Copyright (c) 2012, Tyler Seymour <tyler@unwitty.com>\n *  All rights reserved.\n *\n *  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the\n *  following conditions are met:\n *\n *  Redistributions of source code must retain the above copyright notice, this list of conditions and the following\n *  disclaimer.\n *\n *  Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following\n *  disclaimer in the documentation and/or other materials provided with the distribution.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n *  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n *  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n *  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n *  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n *  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n *  @require alloy.js\n *  @require alloy.session.js\n */\n\n/*global alloy */\n\n/**\n * The Alloy API library\n *\n * The API forces synchronization of requests to the backend API library.  This is useful as the client state may change\n * as each request as made.\n */\nalloy.Api = function() {\n\n\t/**\n\t * Serialized list of requests\n\t * @protected\n\t */\n\tthis._requests = [];\n};\nalloy.makeSingleton(alloy.Api);\n\n/**\n * Push a new request onto the request queue.\n * @param {!object} data - should contain the following keys\n *\t\t\t\t\t\tdata.api\t{!string}\tThe API library to reference\n *\t\t\t\t\t\tdata.call\t{!string}\tThe API call to make\n *\t\t\t\t\t\tdata.data\t{object}\tAny data to pass to the API call\n *\t\t\t\t\t\tdata.success {function} Called upon success (valid response code returned from API.\n *\t\t\t\t\t\tdata.error\t {function} Called upon error (invalid response code returned from API.\n */\nalloy.Api.prototype.request = function(data) {\n\n\tthis._requests.push(data);\n\n\n\tif(this._requests.length === 1) {\n\t\tthis._makeNextCall();\n\t}\n};\n\n/**\n * Make the next API request\n * @param opt_event\n */\nalloy.Api.prototype._makeNextCall = function(opt_event) {\n\n\tif(this._requests.length === 0) {\n\t\treturn;\n\t}\n\n\t// grab the first request in the queue.  Note that this is not removed until the API call returns\n\tvar request\t= this._requests[0];\n\n\tvar payload = request.data || {};\n//\tpayload.data = request.data; //JSON.stringify(request.data);\n\tpayload.api\t\t= request.api;\n\tpayload.call\t= request.call;\n\n\t// Setting session id to be added as authentication header instead of post param.\n\tvar authHeader = alloy.Session.getInstance().getSessionId();\n\n\n\tvar success = function(response) {\n\t\t// each API returns a session ID. Update our local copy as it may have changed\n\t\talloy.Session.getInstance().swallowApiCall(response);\n\n\t\tif(response.status == -1 && response.message == 'Not authorized') {\n\t\t\t$(window).trigger(alloy.events.SESSION_TIMEOUT);\n\t\t\treturn;\n\t\t}\n\n\t\tif(response.status == -1){\n\t\t\trequest.error(response);\n\t\t\treturn;\n\t\t}\n\t\t// function making the API request may pass along optional success and error callbacks\n\t\t// note that the error one is executed in response to an error code from the API, not the\n\t\t// ajax call failing\n\t\tif(response.status && request.success) {\n\t\t\trequest.success(response);\n\t\t}\n\t\tif(!response.status && request.error) {\n\t\t\trequest.error(response);\n\t\t}\n\n\t\t// remove the front of the call queue and if needed, make the next call\n\t\tthis._requests.shift();\n\t\tif(this._requests.length > 0) {\n\t\t\tthis._makeNextCall();\n\t\t}\n\t};\n\n\tvar error = function(event) {\n\n\t\tif(event.status != 200){\n\n\t\t\tvar prevApi = this._requests[0].api;\n\t\t\tvar prevCall = this._requests[0].call;\n\t\t\tif(prevApi != \"logger\"){\n\t\t\t\tvar badRequestStr = \" for request api:\"+this._requests[0].api+\" call: \"+this._requests[0].call;\n\t\t\t\tthis._requests.splice(0,1);\n\n\t\t\t\talloy.Api.getInstance().request({\n\t\t\t\t\tapi: 'logger',\n\t\t\t\t\tcall: 'add',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tmessage: \"\\\"\"+event.status+\" \"+event.statusText+\"\\\"\"+badRequestStr\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: function(response){console.log(response);},\n\t\t\t\t\terror: function(response){console.log(response);}\n\t\t\t\t});\n\n\t\t\t\tif(event.status != 0){\n\t\t\t\t\tbootbox.alert('An error occurred while making a request: '+event.status+' - '+event.statusText);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._requests.shift();\n\t\t\tif(this._requests.length > 0) {\n\t\t\t\tthis._makeNextCall();\n\t\t\t}\n\t\t}\n\n\t};\n\n\t$.ajax(\"/api\", {\n\t\tdata\t: payload,\n\t\tsuccess\t: $.proxy(success, this),\n\t\terror\t: $.proxy(error, this),\n\t\ttype    : 'POST',\n\t\tbeforeSend : function(xhr) {\n\t\t\txhr.setRequestHeader(\"Authorization\", authHeader);\n\t\t}\n\n\t});\n};\n","/**\n *  alloy.view.js - Part of the Alloy Library\n *\n *  Copyright (c) 2012, Tyler Seymour <tyler@unwitty.com>\n *  All rights reserved.\n *\n *  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the\n *  following conditions are met:\n *\n *  Redistributions of source code must retain the above copyright notice, this list of conditions and the following\n *  disclaimer.\n *\n *  Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following\n *  disclaimer in the documentation and/or other materials provided with the distribution.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n *  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n *  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n *  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n *  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n *  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n */\nalloy.View = Backbone.View.extend({\n\n\tinitialize: function(options) {\n\n\t\t_.bindAll(this);\n\t\tthis._initialize(options);\n\n\t\tthis._isRendered = false\n\t\tthis._isBound = false;\n\t\tthis._inDom = false;\n\t},\n\t_initialize: function(options) {},\n\n\tinject: function(element, options) {\n\n\t\toptions = options ? options : {};\n\t\toptions = _.defaults(options, {\n\t\t\tmethod: 'html'\n\t\t});\n\n\t\tif(!this._isRendered) {\n\t\t\tthis.render();\n\t\t}\n\n\t\tif(!this._isBound) {\n\t\t\tthis.bind();\n\t\t}\n\n\n\t\t$(element)[options.method](this.el);\n\n//\t\tif(opt_replace) {\n//\t\t\t$(element).replaceWith(this.el);\n//\t\t} else {\n//\t\t\t$(element).html(this.el);\n//\t\t}\n\n\t\tif(!this._inDom) {\n\t\t\tthis.onEnterDom();\n\t\t}\n\t\treturn this;\n\t},\n\tinjectChild: function(child, element, options) {\n\n\t\tchild.inject(element, options);\n\n\t\tthis.addChild(child);\n\t\treturn this;\n\t},\n\n\trender: function() {\n\t\tif(this._isRendered) {\n\t\t\tthis.unbind();\n\t\t}\n\t\tthis._render();\n\t\tthis.bind();\n\t\tthis._isRendered = true;\n\t\t$('input, textarea', this.el).placeholder();\n\t\treturn this;\n\t},\n\t_render: function() {},\n\taddChild: function(childView) {\n\t\tif(this._children == undefined) {\n\t\t\tthis._children = [];\n\t\t}\n\t\tthis._children.push(childView);\n\t\treturn this;\n\t},\n\tclearChildren: function() {\n\n\t\tthis.unbindChildren();\n\t\tthis._children = [];\n\t\treturn this;\n\t},\n\tbind: function() {\n\n\t\tif(this._isBound) {\n\t\t\treturn this;\n\t\t}\n\n\t\tif(this._isRendered) {\n\t\t\t// Backbone's view will delegate events upon initialization\n\t\t\t// we only need to delegate events if we're re-rendering\n\t\t\tthis.delegateEvents();\n\t\t}\n\n\t\tthis.bindChildren();\n\t\tthis._bind();\n\n\t\tthis._isBound = true;\n\t\treturn this;\n\t},\n\t_bind: function() {},\n\tunbind: function() {\n\t\tthis.stopListening();\n\t\tthis.undelegateEvents();\n\t\tthis.unbindChildren();\n\t\tthis._unbind();\n\t\tthis._isBound = false;\n\t\treturn this;\n\t},\n\t_unbind: function() {},\n\tbindChildren: function() {\n\t\tif(this._children) {\n\t\t\tfor(var i = 0; i < this._children.length; i++) {\n\t\t\t\tthis._children[i].bind();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\tunbindChildren: function() {\n\t\tif(this._children) {\n\t\t\tfor(var i = 0; i < this._children.length; i++) {\n\t\t\t\tthis._children[i].unbind();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\tonEnterDom: function() {\n\n\t\tthis._inDom = true;\n\t\tthis._onEnterDom();\n\t\tif(this._children) {\n\t\t\tfor(var i = 0; i < this._children.length; i++) {\n\t\t\t\tthis._children[i].onEnterDom();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\t_onEnterDom: function() {},\n\tonExitDom: function() {\n\n\t\tthis._inDom = false;\n\t\tthis._onExitDom();\n\t\tif(this._children) {\n\t\t\tfor(var i = 0; i < this._children.length; i++) {\n\t\t\t\tthis._children[i].onExitDom();\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t},\n\t_onExitDom: function() {}\n\n\n\n});","/**\n *  alloy.alerts.js - Part of the Alloy Library\n *\n *  Copyright (c) 2012, Tyler Seymour <tyler@unwitty.com>\n *  All rights reserved.\n *\n *  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the\n *  following conditions are met:\n *\n *  Redistributions of source code must retain the above copyright notice, this list of conditions and the following\n *  disclaimer.\n *\n *  Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following\n *  disclaimer in the documentation and/or other materials provided with the distribution.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n *  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n *  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n *  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n *  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n *  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n *  @require alloy.js\n */\n/*global alloy*/\n\n\nalloy.Alerts = function() {\n\n\tthis._alerts = [];\n};\nalloy.makeSingleton(alloy.Alerts);\n\nalloy.Alerts.prototype.add = function(alertView) {\n\n\tthis._alerts.push(alertView);\n\treturn this;\n};\n\nalloy.Alerts.prototype.show = function(elm) {\n\n\tfor(var i = 0; i < this._alerts.length; i++) {\n\t\tthis._alerts[i].render();\n\t\t$(elm).append(this._alerts[i].el);\n\t\tif($(elm).is(\":hidden\")) {\n\t\t\t$(elm).slideDown();\n\t\t}\n\t}\n\tthis._alerts = [];\n\treturn this;\n};\n","\nalloy.events.OVERLAY_CLOSED = 'overlay_closed';\nalloy.events.SESSION_TIMEOUT = 'session_timeout';","/**\n *  alloy.overlay_manager.js - Part of the Alloy Library\n *\n *  Copyright (c) 2012, Tyler Seymour <tyler@unwitty.com>\n *  All rights reserved.\n *\n *  Redistribution and use in source and binary forms, with or without modification, are permitted provided that the\n *  following conditions are met:\n *\n *  Redistributions of source code must retain the above copyright notice, this list of conditions and the following\n *  disclaimer.\n *\n *  Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following\n *  disclaimer in the documentation and/or other materials provided with the distribution.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n *  INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n *  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n *  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n *  SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n *  USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\n *  @require alloy.js\n *  @require alloy.session.js\n */\n/*global alloy */\n\nalloy.OverlayManager = alloy.OverlayManager || {};\n\nalloy.OverlayManager = function(opt_data) {\n\n\tthis._overlays = [];\n\n\t$(window.document).bind(alloy.OverlayManager.EVENT_CLOSE, $.proxy(this._onOverlayClose, this));\n//\t$(document).bind('keyup', $.proxy(this.onKeyUp, this));\n};\nalloy.makeSingleton(alloy.OverlayManager);\nalloy.OverlayManager.EVENT_CLOSE\t= \"alloy_event_overlay_close\";\n\n\nalloy.OverlayManager.prototype.add = function(view) {\n\n\tthis._overlays.push(view);\n\tif(this._overlays.length === 1) {\n\t\tthis.show(this._overlays[0]);\n\t}\n};\n\nalloy.OverlayManager.prototype.show = function(view) {\n\n\tvar modalSize = view.modalSize ? view.modalSize : 'large';\n\n\tview.render();\n\t$(view.el).addClass('modal modal-' + view.modalSize);\n//\t$(view.el).on('hidden.Overlay', $.proxy(this._onOverlayClose, this));\n\t$(view.el).appendTo($(\"body\")).modal({\n\t\tshow: true,\n\t\tbackdrop:true,\n\t\tkeyboard: false\n\t});\n\tview.onEnterDom();\n\t$(\"body\").addClass('modal-open');\n};\n\nalloy.OverlayManager.prototype._onOverlayClose = function(event, overlay) {\n\n\tthis._overlays[0].unbind();\n\t$(this._overlays[0].el).modal('hide');\n//\t$(\"body\").removeClass('modal-open');\n\tthis._overlays.shift();\n\tif(this._overlays.length > 0) {\n\t\tthis.show(this._overlays[0]);\n\t}\n};\n\nalloy.OverlayManager.prototype.isOpen = function() {\n\treturn this._overlays.length > 0;\n}\n\n//alloy.OverlayManager.prototype.getCurrentOverlay = function() {\n//\treturn this._overlays.length > 0 ? this._overlays[0] : null;\n//};\n\n//alloy.OverlayManager.prototype.closeCurrentAndClearAll = function() {\n//\n//\tif(this._overlays.length > 0) {\n//\t\tvar current = this._overlays.shift();\n//\t\tthis._overlays = [];\n//\t\tcurrent.el.remove();\n//\t}\n//};\n\nalloy.OverlayManager.prototype.closeCurrent = function() {\n\n\tif(this._overlays.length > 0) {\n\t\t$(\"body\").removeClass('modal-open');\n\t\tthis._overlays[0].unbind();\n\t\t$(this._overlays[0].el).modal('hide');\n\t\tthis._overlays.shift();\n\t\tif(this._overlays.length > 0) {\n\t\t\tthis.show(this._overlays[0]);\n\t\t}\n\t\t$(window.document).trigger(alloy.events.OVERLAY_CLOSED);\n\t}\n};\n\n//alloy.OverlayManager.prototype.onKeyUp = function(event) {\n//\tif(event.keyCode == 27 && this._overlays.length > 0) {\n//\t\tthis.closeCurrent();\n//\t}\n//};\n","alloy.tmpl.alert = ([\n\t\"<a class='close' data-dismiss='alert' href='#'>&times;</a>\",\n\t\"{{if title}}<h5>${title}</h5>{{/if}}\",\n\t\"{{if message}}<span>${message}</span>{{/if}}\",\n\t\"{{if html}}<div id='html'></div>{{/if}}\"\n]).join(\"\");\n\n$.templates({\n\t\"alloy.tmpl.alert\": alloy.tmpl.alert\n});\n","\nApp = {\n\tenvironment: null,\n\tmodels: {},\n\tcollections: {},\n\ttmpl: {},\n\tevents: {\n\t\tUSER_DELETED: 'user_deleted',\n\t\tCONTENT_PROGRESS: 'content_progress'\n\t},\n\tviews: {},\n\tcontrols: {},\n\toverlays: {},\n\tvent: _.extend({}, Backbone.Events)\n\n};\n\nApp.Model = Backbone.Model.extend({});\n\nApp.Collection = Backbone.Collection.extend({\n\tmodel: App.Model\n});","\nApp.RouterBase = Backbone.Router.extend({\n\n\n\tpublic: [],\n\trequire_active_account: [],\n\n\tlastViewName: null,\n\theaderControl: null,\n\n\tisPublic: function(name) {\n\t\treturn _.indexOf(this.public, name) >= 0;\n\t},\n\trequiresActiveAccount: function(name) {\n\t\treturn _.indexOf(this.require_active_account, name) >= 0;\n\t},\n\tbefore: function(route, name, args) {\n\n\t\t// verify user can load the view\n\t\t/*if(!App.Data.getInstance().isLoggedIn() && !this.isPublic(name)) {\n\n\t\t}\n\n\t\tif(!this.isPublic() && this.requiresActiveAccount(name) && !App.Data.getInstance().account.get('can_access')) {\n\n\t\t}*/\n\n\t\t$('html, body').animate({\n\t\t\tscrollTop: 0\n\t\t}, 50);\n\n\t\treturn true;\n\t},\n\tinitialize: function(options) {\n\n\t\tthis.currentView = null;\n\n\t\t$(window).bind(alloy.events.SESSION_TIMEOUT, null, $.proxy(this.onSessionTimeout, this));\n\n\t\tthis.bind('route', this._pageView);\n\t},\n\tonSessionTimeout: function(event) {\n\n\t\tevent.stopPropagation();\n\n\t\twindow.location.reload();\n\t},\n\tshowView: function(view) {\n\n\t\tif(this.currentView) {\n\t\t\tthis.currentView.unbind();\n\t\t}\n\t\tthis.currentView = view;\n\n\t\tview.inject($(\"#main\"));\n\t},\n\t_extractParameters: function(route, fragment) {\n\t\tvar result = route.exec(fragment).slice(1);\n\t\tresult.unshift(this._deparam(result[result.length-1]));\n\t\treturn result.slice(0,-1);\n\t},\n\t_deparam: function(paramString){\n\t\tvar result = {};\n\t\tif( ! paramString){\n\t\t\treturn result;\n\t\t}\n\t\t$.each(paramString.split('&'), function(index, value){\n\t\t\tif(value){\n\t\t\t\tvar param = value.split('=');\n\t\t\t\tresult[param[0]] = param[1];\n\t\t\t}\n\t\t});\n\t\treturn result;\n\t},\n\t_pageView: function() {\n\n\t\tvar path = Backbone.history.getFragment();\n\t\tvar route = path.split('?')[0];\n\t}\n});\n","App.Router = App.RouterBase.extend({\n\n\troutes: {\n\t\t\"\": \"businesses\"\n\t},\n\tpublic: [\n\t\t\"businesses\"\n\t],\n\trequire_active_account: [],\n\n\tbusinesses: function(opt_params) {\n\t\t\tvar view = new App.views.PageBusinesses();\n\t\t\tthis.showView(view);\n\t}\n});\nalloy.makeSingleton(App.Router);\n","//start \n App.tmpl.tmpl_page_businesses = '#tmpl_page_businesses'; \n App.tmpl.tmpl_partial_business = '#tmpl_partial_business'; \n //end","\nApp.Data = function(data) {\n\n\t_.bindAll(this);\n\n\tdata = data || {};\n\n\n\tdata = _.defaults(data, {\n\t\tsession: new App.Model(),\n\t\tuser: new App.Model(),\n\t\taccount: new App.Model(),\n\t\tusers: new App.Collection(),\n\t\tclubhouseSubscription: new App.Model(),\n\t\tcompletedTasks: new App.Collection(),\n\t\tprogress: new App.Collection(),\n\t\tchapterActivities: new App.Collection()\n\t});\n\n\n\t_.extend(this, data);\n\t\n\t// make sure the root user and the one included in the full user list are the same model\n\tif(this.user.get('id')) {\n\t\tvar user = this.users.get(this.user.get('id'));\n\t\tif(user) {\n\t\t\tthis.user = user;\n\t\t}\n\t}\n};\nalloy.makeSingleton(App.Data);\n\nApp.Data.prototype.isLoggedIn = function() {\n\n\treturn !(this.user.get('role') == 'anon' || this.user.get('role') == undefined);\n};\n\n\n","\nApp.views.PageBusinesses = alloy.View.extend({\n\n\tclassName: 'container',\n\tevents: {},\n\n\t_initialize: function(options) {\n\t\tthis.businessesContainer = \"#businesses\"\n\t},\n\n\t_render: function() {\n\t\t$(this.el).html($(App.tmpl.tmpl_page_businesses).render());\n\n\t\talloy.Api.getInstance().request({\n\t\t\tapi: 'business',\n\t\t\tcall: 'get',\n\t\t\tsuccess: this.onBusinesses\n\t\t});\n\t},\n\n\tonBusinesses: function(response) {\n\n\t\tvar businesses = new App.Collection(response.data.businesses);\n\t\tbusinesses.forEach(this.injectBusiness);\n\t},\n\n\tinjectBusiness: function(business) {\n\n\t\t$(this.businessesContainer, this.el).append($(App.tmpl.tmpl_partial_business).render({\n\t\t\tbusiness: business.toJSON()\n\t\t}));\n\t},\n});\n"],"sourceRoot":"/source/"}